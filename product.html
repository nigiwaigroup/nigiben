<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nigiwai Group | Live Executive Dashboard</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">

    <style>
        body { font-family: 'Noto Sans Thai', sans-serif; background-color: #f8fafc; }
        
        .dataTables_wrapper .dataTables_filter input { border: 1px solid #cbd5e1; border-radius: 0.375rem; padding: 0.35rem 0.75rem; font-size: 0.875rem; outline: none; margin-left: 0.5rem; }
        .dataTables_wrapper .dataTables_filter input:focus { border-color: #3b82f6; box-shadow: 0 0 0 1px #3b82f6; }
        
        table.dataTable thead th { border-bottom: 2px solid #e2e8f0; font-size: 0.875rem; color: #475569; font-weight: 600; padding: 1rem 0.75rem; text-align: center; cursor: pointer; }
        table.dataTable thead th:hover { background-color: #e2e8f0; }
        
        table.dataTable tbody td { border-bottom: 1px solid #f1f5f9; font-size: 0.875rem; color: #334155; padding: 0.75rem; text-align: center; vertical-align: middle; }
        table.dataTable tbody tr:hover { background-color: #f8fafc; }

        /* ‡∏™‡∏µ‡∏™‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç */
        .val-zero { color: #94a3b8; }
        .val-positive { color: #16a34a; font-weight: 600; background-color: #dcfce7; padding: 0.25rem 0.5rem; border-radius: 9999px; display: inline-block; min-width: 2.5rem; }
        .val-negative { color: #dc2626; font-weight: 600; background-color: #fee2e2; padding: 0.25rem 0.5rem; border-radius: 9999px; display: inline-block; min-width: 2.5rem; }
        .waste-val { color: #dc2626; font-weight: 600; }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà Edit ‡πÑ‡∏î‡πâ */
        .editable-cell { cursor: pointer; transition: all 0.2s; position: relative; }
        .editable-cell:hover { background-color: #eff6ff; border-radius: 0.25rem; box-shadow: inset 0 0 0 1px #93c5fd; }
        .editable-cell:focus { outline: none; background-color: #fff; box-shadow: inset 0 0 0 2px #3b82f6; border-radius: 0.25rem; }

        .table-container::-webkit-scrollbar { height: 8px; width: 8px; }
        .table-container::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 4px; }
        .table-container::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .table-container::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* Loading Overlay */
        #loader { position: fixed; inset: 0; background: rgba(255,255,255,0.9); z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
    </style>
</head>
<body class="text-slate-800">

    <div id="loader">
        <i class="fas fa-circle-notch fa-spin text-5xl text-amber-500 mb-4"></i>
        <p class="font-bold text-slate-700 text-lg">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets...</p>
        <p class="text-sm text-slate-500 mt-1">Live Data Synchronization (API)</p>
    </div>

    <header class="bg-white border-b border-gray-200 shadow-sm sticky top-0 z-50">
        <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 rounded bg-gradient-to-tr from-slate-800 to-slate-900 flex items-center justify-center text-amber-500 shadow">
                        <i class="fas fa-gem text-lg"></i>
                    </div>
                    <div>
                        <h1 class="font-bold text-xl tracking-wide text-slate-800">NIGIWAO GROUP</h1>
                        <p class="text-[11px] text-slate-500 uppercase tracking-widest font-semibold">Live Executive Data Hub</p>
                    </div>
                </div>
                
                <div class="flex items-center gap-4">
                    <span class="hidden sm:flex items-center gap-2 px-3 py-1.5 bg-emerald-50 text-emerald-600 rounded-md text-[11px] font-semibold border border-emerald-100">
                        <i class="fas fa-cloud-arrow-down"></i> LIVE SYNC ACTIVE
                    </span>
                    <button onclick="location.reload()" class="w-9 h-9 flex items-center justify-center rounded-md hover:bg-slate-100 text-slate-500 transition-colors border border-transparent hover:border-slate-200" title="Refresh Data">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <div class="mb-8 flex flex-col md:flex-row md:items-end justify-between gap-4">
            <div>
                <h2 class="text-2xl font-bold text-slate-800 flex items-center gap-3">
                    <i class="fas fa-satellite-dish text-amber-500 animate-pulse"></i>
                    ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ Real-time (‡∏ú‡∏π‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets)
                </h2>
                <p class="text-slate-500 mt-1">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏î‡∏∂‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏î‡∏ó‡∏µ‡πà‡∏´‡∏±‡∏ß‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠ Sort ‡πÅ‡∏•‡∏∞ <strong class="text-blue-600">‡∏Å‡∏î‡∏ó‡∏µ‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</strong> ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>
                <p class="text-emerald-600 mt-1 text-sm"><i class="fas fa-info-circle mr-1"></i>‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 24 ‡∏Å.‡∏û. = ‡∏¢‡∏≠‡∏î‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤(‡∏£‡∏ß‡∏°‡∏¢‡∏Å‡∏°‡∏≤) - ‡∏Ç‡∏≤‡∏¢ - ‡πÅ‡∏à‡∏Å - ‡∏™‡∏π‡∏ç‡πÄ‡∏™‡∏µ‡∏¢</p>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-5 flex items-center justify-between">
                <div>
                    <p class="text-xs text-slate-500 font-bold uppercase tracking-wider mb-1">Total Remaining (24 Feb)</p>
                    <h3 id="kpi-cf" class="text-3xl font-bold text-slate-800">...</h3>
                </div>
                <div class="w-14 h-14 rounded-full bg-rose-50 border border-rose-100 flex items-center justify-center text-rose-500">
                    <i class="fas fa-exclamation-triangle text-2xl"></i>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-5 flex items-center justify-between">
                <div>
                    <p class="text-xs text-slate-500 font-bold uppercase tracking-wider mb-1">Total Waste (2 Days)</p>
                    <h3 id="kpi-waste" class="text-3xl font-bold text-rose-600">...</h3>
                </div>
                <div class="w-14 h-14 rounded-full bg-rose-50 border border-rose-100 flex items-center justify-center text-rose-500">
                    <i class="fas fa-trash-can text-2xl"></i>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-5 flex items-center justify-between">
                <div>
                    <p class="text-xs text-slate-500 font-bold uppercase tracking-wider mb-1">Total Received</p>
                    <h3 id="kpi-in" class="text-3xl font-bold text-blue-600">...</h3>
                </div>
                <div class="w-14 h-14 rounded-full bg-blue-50 border border-blue-100 flex items-center justify-center text-blue-500">
                    <i class="fas fa-truck-ramp-box text-2xl"></i>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-5 flex items-center justify-between">
                <div>
                    <p class="text-xs text-slate-500 font-bold uppercase tracking-wider mb-1">Total Sold</p>
                    <h3 id="kpi-sold" class="text-3xl font-bold text-emerald-600">...</h3>
                </div>
                <div class="w-14 h-14 rounded-full bg-emerald-50 border border-emerald-100 flex items-center justify-center text-emerald-500">
                    <i class="fas fa-cash-register text-2xl"></i>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="px-6 py-4 border-b border-slate-200 bg-slate-50 flex justify-between items-center">
                <h3 class="font-bold text-slate-700 text-lg"><i class="fas fa-table-list mr-2 text-slate-400"></i>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                <span class="text-xs text-slate-500 bg-slate-200 px-2 py-1 rounded"><i class="fas fa-pen text-[10px] mr-1"></i>‡∏î‡∏±‡∏ö‡πÄ‡∏ö‡∏¥‡πâ‡∏•‡∏Ñ‡∏•‡∏¥‡∏Å/‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</span>
            </div>
            <div class="p-6 table-container overflow-x-auto">
                <table id="inventoryTable" class="w-full whitespace-nowrap" width="100%">
                    <thead>
                        <tr>
                            <th class="bg-slate-800 text-white rounded-tl-md" rowspan="2" style="background-color: #1e293b;">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                            <th class="bg-slate-800 text-white" rowspan="2" style="background-color: #1e293b;">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                            <th class="text-left bg-slate-800 text-white" rowspan="2" style="background-color: #1e293b; padding-left: 1rem;">‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                            <th class="text-left bg-slate-800 text-white" rowspan="2" style="background-color: #1e293b;">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Item Name)</th>
                            <th colspan="5" style="background-color: #f1f5f9; border-right: 1px solid #cbd5e1;">‡∏¢‡∏≠‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 23 ‡∏Å.‡∏û. 2569</th>
                            <th colspan="5" style="background-color: #e2e8f0; border-right: 1px solid #cbd5e1;" class="rounded-tr-md">‡∏¢‡∏≠‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 24 ‡∏Å.‡∏û. 2569</th>
                        </tr>
                        <tr>
                            <th style="background-color: #f8fafc;">‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤</th>
                            <th style="background-color: #f8fafc;">‡∏Ç‡∏≤‡∏¢</th>
                            <th style="background-color: #f8fafc;">‡πÅ‡∏à‡∏Å/‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</th>
                            <th style="background-color: #f8fafc; color: #dc2626;">‡∏™‡∏π‡∏ç‡πÄ‡∏™‡∏µ‡∏¢</th>
                            <th style="background-color: #f8fafc; border-right: 1px solid #cbd5e1;">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                            
                            <th style="background-color: #f1f5f9;">‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤(‡∏£‡∏ß‡∏°‡∏¢‡∏Å‡∏°‡∏≤)</th>
                            <th style="background-color: #f1f5f9;">‡∏Ç‡∏≤‡∏¢</th>
                            <th style="background-color: #f1f5f9;">‡πÅ‡∏à‡∏Å/‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</th>
                            <th style="background-color: #f1f5f9; color: #dc2626;">‡∏™‡∏π‡∏ç‡πÄ‡∏™‡∏µ‡∏¢</th>
                            <th style="background-color: #f1f5f9;">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </div>
        </div>
        
        <div class="mt-8 mb-12 text-center text-slate-400 text-sm">
            &copy; 2026 Nigiwai Group Executive Portal. Live Sync Enabled.
        </div>
    </main>

    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    
    <script>
        // üö® ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏õ‡πá‡∏ô Google Visualization API ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÇ‡∏î‡∏ô‡∏ö‡∏•‡πá‡∏≠‡∏Å
        const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/11Mu-cO632cHm1oqp4CJpbIP4BUrIoEr7Rr5H3gbK3C0/gviz/tq?tqx=out:csv&gid=1104128225";

        function fmtStd(v) { return v === 0 ? '<span class="val-zero">0</span>' : v; }
        function fmtWaste(v) { return v > 0 ? '<span class="waste-val">-' + v + '</span>' : '<span class="val-zero">0</span>'; }
        function fmtStock(v) { 
            if (v > 0) return '<span class="val-positive">+' + v + '</span>';
            if (v < 0) return '<span class="val-negative">' + v + '</span>';
            return '<span class="val-zero">0</span>';
        }
        function parseNum(val) {
            if(!val) return 0;
            var num = parseFloat(String(val).replace(/[^0-9.-]/g, ''));
            return isNaN(num) ? 0 : num;
        }

        $(document).ready(function() {
            Papa.parse(SHEET_CSV_URL, {
                download: true,
                header: false,
                complete: function(results) {
                    var data = results.data;
                    var tbodyHtml = "";
                    
                    // ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà 3 (‡∏Ç‡πâ‡∏≤‡∏° Header ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Sheet)
                    for (var i = 3; i < data.length; i++) {
                        var row = data[i];
                        if (!row || !row[4]) continue; 

                        var no = row[0] || '';
                        var category = row[1] || '';
                        var code = row[2] || '';
                        var name_th = row[5] || '';

                        var in_23 = parseNum(row[12]);
                        var sold_23 = parseNum(row[13]);
                        var ga_23 = parseNum(row[14]);
                        var waste_23 = parseNum(row[15]);
                        var cf_23 = parseNum(row[16]);

                        var raw_in_24 = parseNum(row[20]);
                        var sold_24 = parseNum(row[21]);
                        var ga_24 = parseNum(row[22]);
                        var waste_24 = parseNum(row[23]);

                        // ‡∏Å‡∏é‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏ó‡∏¥‡∏û‡∏¢‡πå 
                        if (name_th === '‡∏ô‡πâ‡∏≥‡πÄ‡∏õ‡∏•‡πà‡∏≤ ‡∏ô‡πâ‡∏≥‡∏ó‡∏¥‡∏û‡∏¢‡πå') { sold_24 = 199; }

                        var in_24_calc = raw_in_24 + cf_23; 
                        var cf_24_calc = in_24_calc - sold_24 - ga_24 - waste_24; 

                        tbodyHtml += "<tr>";
                        tbodyHtml += '<td class="font-medium text-slate-600">' + category + '</td>';
                        tbodyHtml += '<td class="font-mono text-slate-500">' + no + '</td>';
                        tbodyHtml += '<td class="text-left font-mono text-sm text-slate-500 pl-4">' + code + '</td>';
                        tbodyHtml += '<td class="text-left font-medium text-slate-700">' + name_th + '</td>';
                        
                        tbodyHtml += '<td class="editable-cell" contenteditable="true" data-col="in23">' + fmtStd(in_23) + '</td>';
                        tbodyHtml += '<td class="editable-cell" contenteditable="true" data-col="sold23">' + fmtStd(sold_23) + '</td>';
                        tbodyHtml += '<td class="editable-cell" contenteditable="true" data-col="ga23">' + fmtStd(ga_23) + '</td>';
                        tbodyHtml += '<td class="editable-cell" contenteditable="true" data-col="waste23">' + fmtWaste(waste_23) + '</td>';
                        tbodyHtml += '<td style="border-right: 1px dashed #cbd5e1;" data-col="cf23">' + fmtStock(cf_23) + '</td>';
                        
                        tbodyHtml += '<td class="editable-cell bg-slate-50" contenteditable="true" data-col="in24">' + fmtStd(in_24_calc) + '</td>';
                        tbodyHtml += '<td class="editable-cell bg-slate-50" contenteditable="true" data-col="sold24">' + fmtStd(sold_24) + '</td>';
                        tbodyHtml += '<td class="editable-cell bg-slate-50" contenteditable="true" data-col="ga24">' + fmtStd(ga_24) + '</td>';
                        tbodyHtml += '<td class="editable-cell bg-slate-50" contenteditable="true" data-col="waste24">' + fmtWaste(waste_24) + '</td>';
                        tbodyHtml += '<td class="bg-slate-50" data-col="cf24">' + fmtStock(cf_24_calc) + '</td>';
                        tbodyHtml += "</tr>";
                    }

                    $('#loader').fadeOut('fast');
                    $('#inventoryTable tbody').html(tbodyHtml);

                    var table = $('#inventoryTable').DataTable({
                        "paging": false, 
                        "info": false,   
                        "order": [[0, 'asc'], [1, 'asc']], 
                        "language": {
                            "search": "<i class='fas fa-search text-slate-400 mr-1'></i> ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:"
                        }
                    });

                    recalcKPIs();

                    $('#inventoryTable tbody').on('input', 'td[contenteditable="true"]', function() {
                        var row = $(this).closest('tr');
                        
                        var in_24 = parseNum(row.find('td[data-col="in24"]').text());
                        var sold_24 = parseNum(row.find('td[data-col="sold24"]').text());
                        var ga_24 = parseNum(row.find('td[data-col="ga24"]').text());
                        var waste_24 = Math.abs(parseNum(row.find('td[data-col="waste24"]').text())); 
                        
                        var new_cf_24 = in_24 - sold_24 - ga_24 - waste_24;
                        
                        row.find('td[data-col="cf24"]').html(fmtStock(new_cf_24));
                        recalcKPIs();
                    });

                    $('#inventoryTable tbody').on('blur', 'td[contenteditable="true"]', function() {
                        var val = Math.abs(parseNum($(this).text()));
                        var colType = $(this).data('col');
                        if (colType === 'waste23' || colType === 'waste24') {
                            $(this).html(fmtWaste(val));
                        } else {
                            $(this).html(fmtStd(val));
                        }
                    });
                },
                error: function(err) {
                    $('#loader').html('<i class="fas fa-times-circle text-5xl text-rose-500 mb-4"></i><p class="font-bold text-slate-700 text-lg">‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ</p><p class="text-sm mt-2 text-slate-500">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏•‡∏¥‡∏á‡∏Å‡πå Google Sheets ‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡∏¥‡∏î Share ‡πÅ‡∏ö‡∏ö "Anyone with the link" ‡πÅ‡∏•‡πâ‡∏ß</p><button onclick="location.reload()" class="mt-6 px-4 py-2 bg-blue-500 text-white rounded shadow hover:bg-blue-600">‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>');
                    console.error("PapaParse Error:", err);
                }
            });

            function recalcKPIs() {
                var tot_cf = 0, tot_waste = 0, tot_in = 0, tot_sold = 0;
                
                $('#inventoryTable tbody tr').each(function() {
                    tot_waste += Math.abs(parseNum($(this).find('td[data-col="waste23"]').text())) + Math.abs(parseNum($(this).find('td[data-col="waste24"]').text()));
                    tot_in += parseNum($(this).find('td[data-col="in23"]').text()) + parseNum($(this).find('td[data-col="in24"]').text());
                    tot_sold += parseNum($(this).find('td[data-col="sold23"]').text()) + parseNum($(this).find('td[data-col="sold24"]').text());
                    tot_cf += parseNum($(this).find('td[data-col="cf24"]').text());
                });

                $('#kpi-cf').html(tot_cf.toLocaleString() + ' <span class="text-sm font-normal text-slate-400">‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>');
                $('#kpi-waste').html(tot_waste.toLocaleString() + ' <span class="text-sm font-normal text-slate-400">‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>');
                $('#kpi-in').html(tot_in.toLocaleString() + ' <span class="text-sm font-normal text-slate-400">‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>');
                $('#kpi-sold').html(tot_sold.toLocaleString() + ' <span class="text-sm font-normal text-slate-400">‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>');
            }
        });
    </script>
</body>
</html>
